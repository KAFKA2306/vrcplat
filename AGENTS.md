# リポジトリガイドライン

## プロジェクト構造とモジュールの構成
- `docs/` は、戦略、要件、および発見ノートの信頼できる情報源です。コンテキストを散らかすのではなく、既存のドラフトを更新してください。
- コードが配置されたら、バックエンドAPI用に `services/` を作成し（各サービスは `src/`、`tests/`、`README.md` を保持します）、運用UI用に `apps/dashboard/` を作成します。
- Presence、Purchase、およびAvatar Diffモデルを連携させるために、`packages/shared/` でドメインコントラクトを共有します。
- 図、モックフロー、および匿名化されたペイロードサンプルを `docs/assets/` に保存し、それらがサポートする物語と一緒に提供します。

## ビルド、テスト、および開発コマンド
- 現在の成果物を整頓するために、すべてのコミットの前に `npx markdownlint-cli2 docs/**/*.md` と `npx cspell docs` を実行してください。
- `package.json` が表示されたら、pnpmワークスペースを初期化します（`pnpm install`）。ローカルAPI/UIループ用に `pnpm lint`（eslint + prettier --check）、`pnpm test -- --runInBand`、`pnpm dev` などのスクリプトを公開します。
- ドリフトを防ぐために、そのサービスのREADMEでサービス固有のブートストラップ手順（環境変数、シードデータ）を明らかにします。

## コーディングスタイルと命名規則
- バックエンドサービスにはTypeScriptを、フロントエンドアプリにはReact/Next.jsを優先します。Prettier + ESLint（2スペースインデント、単一引用符、末尾のカンマ）を強制します。
- ファイル名はkebab-caseで命名します。PascalCaseはReactコンポーネントとドメインクラスのために予約します。APIハンドラーはリソース名詞を反映する必要があります（`presence-controller.ts`、`purchases-router.ts`）。
- レビューしやすい差分を作成するために、Markdownの見出しはセンテンスケースで記述し、散文は100文字で折り返します。

## テストガイドライン
- サービスにはVitest、ReactにはTesting Library、スモークフローにはPlaywrightを使用して、80％以上のステートメントカバレッジを目標とします。
- `tests/` でソースパスをミラーリングし（`src/presence/client.ts` → `tests/presence/client.test.ts`）、VRChatログフィクスチャにそれらが表す同意スコープをタグ付けします。
- `tests/contracts/` の下にJSONスキーマスナップショットをキャプチャし、統合作業をマージする前に匿名化されたWebhookペイロードに対して検証します。

## コミットとプルリクエストのガイドライン
- 65文字未満の命令形の英語の件名を書きます（`Add avatar diff schema`、`Guard consent toggles`）。可能であれば、ドキュメントとコードの更新を分割します。
- プルリクエストは、関連する問題をリンクし、スコープの概要を説明し、検証コマンドをリストし、UIまたは外部統合に影響を与える変更のスクリーンショットまたはAPIトレースを含める必要があります。
- 同意、支払い、またはテレメトリのサーフェスを変更する場合は、製品およびエンジニアリングのリードから承認を得てください。

## プライバシーとデータ処理
- gitにライブプレゼンス、購入、または同意ペイロードを保存しないでください。`docs/examples/` の下にマスクされた例を使用し、明確な使用上の注意を記載してください。
- 中央ボールトを介してシークレットを管理します。`.env` ファイルはリポジトリの外部にあります。インストルメンテーションまたはロギングが拡大するたびに、保持期間、オプトアウトフロー、およびエクスポートエンドポイントを記述してください。